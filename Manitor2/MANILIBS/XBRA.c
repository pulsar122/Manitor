/*----------------------------------------------------------------------------------------	XBRA.c, hanging in vectors via XBRA method		?.?.1998 by Manfred Lippert, mani@mani.de	last change: 10.7.1999----------------------------------------------------------------------------------------*/#include <XBRA.h>#include <xbios.h>/*	ACHTUNG!!! Einige Funktionen nicht reentrant!!!*/static XBRA *xbra;static xbra_function *vector;static int32 sup_install_XBRA(void) {	ENTER_CALLBACK();						/* SingleTOS verstellt A5 bei Supexec!!! */	xbra->old = *vector;					/* Alten Vektor merken */	*vector = (xbra_function)(xbra + 1);	/* Funktion einklinken */	EXIT_CALLBACK();	return 0L;}void install_XBRA_super(XBRA *the_xbra, xbra_function *the_vector) {	the_xbra->old = *the_vector;					/* Alten Vektor merken */	*the_vector = (xbra_function)(the_xbra + 1);	/* Funktion einklinken */}void install_XBRA_user(XBRA *the_xbra, xbra_function *the_vector) {	xbra = the_xbra;	vector = the_vector;	Supexec(sup_install_XBRA);}static int32 sup_check_XBRA(void) {	ENTER_CALLBACK();						/* SingleTOS verstellt A5 bei Supexec!!! */	XBRA *x;	while (vector && *vector) {		x = (XBRA *)(*vector) - 1;		/* Weiterhangeln */		if (x->xbra != 'XBRA') {		/* Kette zuende (oder unterbrochen...) */			EXIT_CALLBACK();			return (int32)FALSE;		}		if (x->id == xbra->id) {	/* Kennung gefunden */			EXIT_CALLBACK();			return (int32)TRUE;		}		vector = &x->old;	}	EXIT_CALLBACK();	return (int32)FALSE;}bool check_XBRA_super(XBRA *the_xbra, xbra_function *the_vector) {	XBRA *x;	while (the_vector && *the_vector) {		x = ((XBRA *)(*the_vector)) - 1;	/* Weiterhangeln */		if (x->xbra != 'XBRA') {			/* Kette zuende (oder unterbrochen...) */			return FALSE;		}		if (x->id == the_xbra->id) {		/* Kennung gefunden */			return TRUE;		}		the_vector = &x->old;	}	return FALSE;}bool check_XBRA_user(XBRA *the_xbra, xbra_function *the_vector) {	xbra = the_xbra;	vector = the_vector;	return (bool)Supexec(sup_check_XBRA);}static int32 sup_remove_XBRA(void) {	ENTER_CALLBACK();						/* SingleTOS verstellt A5 bei Supexec!!! */	XBRA *x;	xbra_function func = (xbra_function)(xbra + 1);	/* Diese Funktion ist auszuklinken */	while (vector && *vector) {		if (*vector == func) {			*vector = xbra->old;		/* Funktion gefunden, ausklinken */			EXIT_CALLBACK();			return (int32)TRUE;		}		x = (XBRA *)(*vector) - 1;		/* Weiterhangeln */		if (x->xbra != 'XBRA') {		/* Kette unterbrochen! */			EXIT_CALLBACK();			return (int32)FALSE;		}		vector = &x->old;	}	EXIT_CALLBACK();	return (int32)FALSE;}bool remove_XBRA_super(XBRA *the_xbra, xbra_function *the_vector) {	XBRA *x;	xbra_function func = (xbra_function)(the_xbra + 1);	/* Diese Funktion ist auszuklinken */		while (the_vector && *the_vector) {		if (*the_vector == func) {			*the_vector = the_xbra->old;		/* Funktion gefunden, ausklinken */			return (int32)TRUE;		}		x = ((XBRA *)(*the_vector)) - 1;		/* Weiterhangeln */		if (x->xbra != 'XBRA') {				/* Kette unterbrochen! */			return FALSE;		}		the_vector = &x->old;	}	return FALSE;}bool remove_XBRA_user(XBRA *the_xbra, xbra_function *the_vector) {	xbra = the_xbra;	vector = the_vector;	return (bool)Supexec(sup_remove_XBRA);}